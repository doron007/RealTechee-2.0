<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RealTechee GraphQL Testing Scenarios</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: #f8f9fa;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .test-runner {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .test-suite {
            background: white;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .suite-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .suite-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .suite-status {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending { background: #e2e3e5; color: #495057; }
        .status-running { background: #fff3cd; color: #856404; }
        .status-passed { background: #d4edda; color: #155724; }
        .status-failed { background: #f8d7da; color: #721c24; }
        
        .suite-body {
            padding: 0;
        }
        
        .test-case {
            border-bottom: 1px solid #f8f9fa;
            transition: background-color 0.3s ease;
        }
        
        .test-case:hover {
            background: #f8f9ff;
        }
        
        .test-case:last-child {
            border-bottom: none;
        }
        
        .test-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .test-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .test-description {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .test-meta {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-duration {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .test-body {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: none;
        }
        
        .test-body.active {
            display: block;
        }
        
        .test-query {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
            margin-bottom: 15px;
            white-space: pre;
            overflow-x: auto;
        }
        
        .test-result {
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
            white-space: pre;
            overflow-x: auto;
        }
        
        .test-result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .auth-config {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .auth-config h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .auth-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }
        
        .input-group input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .log-viewer {
            background: #1a1a1a;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8rem;
            height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            display: flex;
            gap: 10px;
        }
        
        .log-timestamp {
            color: #a0aec0;
        }
        
        .log-level-info { color: #63b3ed; }
        .log-level-success { color: #68d391; }
        .log-level-warning { color: #fbb6ce; }
        .log-level-error { color: #fc8181; }
        
        .btn-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 6px;
            display: inline-block;
            margin-bottom: 30px;
            transition: transform 0.3s ease;
        }
        
        .btn-back:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç RealTechee GraphQL Testing Scenarios</h1>
        <p>Comprehensive test scenarios for authentication, validation, and business rules</p>
    </div>
    
    <div class="container">
        <a href="./index.html" class="btn-back">‚Üê Back to Playground</a>
        
        <div class="test-runner">
            <h2>üöÄ Test Runner</h2>
            
            <div class="auth-config">
                <h4>üîê Authentication Configuration</h4>
                <div class="auth-inputs">
                    <div class="input-group">
                        <label for="apiKey">API Key</label>
                        <input type="text" id="apiKey" placeholder="Enter your API key">
                    </div>
                    <div class="input-group">
                        <label for="authToken">Auth Token (Bearer)</label>
                        <input type="text" id="authToken" placeholder="Enter JWT token">
                    </div>
                    <div class="input-group">
                        <label for="userRole">User Role</label>
                        <select id="userRole">
                            <option value="">Select role</option>
                            <option value="super_admin">Super Admin</option>
                            <option value="admin">Admin</option>
                            <option value="agent">Agent</option>
                            <option value="homeowner">Homeowner</option>
                            <option value="accounting">Accounting</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="test-controls">
                <button class="btn btn-primary" onclick="runAllTests()">üèÉ‚Äç‚ôÇÔ∏è Run All Tests</button>
                <button class="btn btn-success" onclick="runSuite('authentication')">üîê Auth Tests</button>
                <button class="btn btn-warning" onclick="runSuite('validation')">‚úÖ Validation Tests</button>
                <button class="btn btn-danger" onclick="runSuite('business')">üíº Business Logic</button>
                <button class="btn btn-secondary" onclick="clearResults()">üóëÔ∏è Clear Results</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="passedTests">0</div>
                    <div class="stat-label">Passed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedTests">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgDuration">0ms</div>
                    <div class="stat-label">Avg Duration</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="log-viewer" id="logViewer">
                <div class="log-entry">
                    <span class="log-timestamp">00:00:00</span>
                    <span class="log-level-info">[INFO]</span>
                    <span>Test runner initialized. Configure authentication and click "Run All Tests" to begin.</span>
                </div>
            </div>
        </div>
        
        <!-- Authentication Test Suite -->
        <div class="test-suite" id="authenticationSuite">
            <div class="suite-header">
                <div class="suite-title">üîê Authentication & Authorization Tests</div>
                <div class="suite-status">
                    <span class="status-badge status-pending" id="authStatus">Pending</span>
                </div>
            </div>
            <div class="suite-body">
                <div class="test-case" data-test="auth-no-token">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Unauthenticated Access</div>
                                <div class="test-description">Test access without any authentication token</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query">mutation TestUnauthenticated {
  createContacts(input: {
    fullName: "Test User"
    email: "test@example.com"
  }) {
    id
    fullName
    email
  }
}</div>
                        <div class="test-result" id="result-auth-no-token">Waiting to run...</div>
                    </div>
                </div>
                
                <div class="test-case" data-test="auth-api-key">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">API Key Access</div>
                                <div class="test-description">Test read access with API key only</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query">query TestApiKeyAccess {
  listContacts(limit: 5) {
    items {
      id
      fullName
      email
    }
  }
}</div>
                        <div class="test-result" id="result-auth-api-key">Waiting to run...</div>
                    </div>
                </div>
                
                <div class="test-case" data-test="auth-jwt-token">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">JWT Token Access</div>
                                <div class="test-description">Test authenticated access with valid JWT token</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query">query TestJwtAccess {
  listRequests(limit: 5) {
    items {
      id
      status
      priority
      homeowner {
        fullName
        email
      }
    }
  }
}</div>
                        <div class="test-result" id="result-auth-jwt-token">Waiting to run...</div>
                    </div>
                </div>
                
                <div class="test-case" data-test="auth-role-permissions">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Role-Based Permissions</div>
                                <div class="test-description">Test access based on user role (agent vs admin)</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query">query TestRolePermissions {
  listNotificationTemplate {
    items {
      id
      name
      formType
      emailSubject
    }
  }
}</div>
                        <div class="test-result" id="result-auth-role-permissions">Waiting to run...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Validation Test Suite -->
        <div class="test-suite" id="validationSuite">
            <div class="suite-header">
                <div class="suite-title">‚úÖ Data Validation Tests</div>
                <div class="suite-status">
                    <span class="status-badge status-pending" id="validationStatus">Pending</span>
                </div>
            </div>
            <div class="suite-body">
                <div class="test-case" data-test="validation-required-fields">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Required Field Validation</div>
                                <div class="test-description">Test missing required fields</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query">mutation TestRequiredFields {
  createContacts(input: {
    fullName: "Test User"
    # email field missing (required)
  }) {
    id
    fullName
    email
  }
}</div>
                        <div class="test-result" id="result-validation-required-fields">Waiting to run...</div>
                    </div>
                </div>
                
                <div class="test-case" data-test="validation-email-format">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Email Format Validation</div>
                                <div class="test-description">Test invalid email format</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query">mutation TestEmailFormat {
  createContacts(input: {
    fullName: "Test User"
    email: "invalid-email-format"
  }) {
    id
    fullName
    email
  }
}</div>
                        <div class="test-result" id="result-validation-email-format">Waiting to run...</div>
                    </div>
                </div>
                
                <div class="test-case" data-test="validation-enum-values">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Enum Value Validation</div>
                                <div class="test-description">Test invalid enum values</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query">mutation TestEnumValidation($input: CreateRequestsInput!) {
  createRequests(input: $input) {
    id
    priority
    status
  }
}

# Variables:
{
  "input": {
    "status": "invalid_status",
    "priority": "invalid_priority",
    "product": "Test Product"
  }
}</div>
                        <div class="test-result" id="result-validation-enum-values">Waiting to run...</div>
                    </div>
                </div>
                
                <div class="test-case" data-test="validation-data-types">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Data Type Validation</div>
                                <div class="test-description">Test incorrect data types</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query">mutation TestDataTypes($input: CreateRequestsInput!) {
  createRequests(input: $input) {
    id
    estimatedValue
    readinessScore
  }
}

# Variables:
{
  "input": {
    "status": "new",
    "product": "Test Product",
    "estimatedValue": "invalid_number",
    "readinessScore": "not_a_number"
  }
}</div>
                        <div class="test-result" id="result-validation-data-types">Waiting to run...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Business Logic Test Suite -->
        <div class="test-suite" id="businessSuite">
            <div class="suite-header">
                <div class="suite-title">üíº Business Logic Tests</div>
                <div class="suite-status">
                    <span class="status-badge status-pending" id="businessStatus">Pending</span>
                </div>
            </div>
            <div class="suite-body">
                <div class="test-case" data-test="business-assignment-rules">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Request Assignment Rules</div>
                                <div class="test-description">Test automatic request assignment logic</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query"># Test assignment to non-existent agent
mutation TestInvalidAssignment($input: UpdateRequestsInput!) {
  updateRequests(input: $input) {
    id
    assignedTo
    status
  }
}

# Variables:
{
  "input": {
    "id": "test-request-id",
    "assignedTo": "nonexistent@agent.com",
    "status": "assigned"
  }
}</div>
                        <div class="test-result" id="result-business-assignment-rules">Waiting to run...</div>
                    </div>
                </div>
                
                <div class="test-case" data-test="business-notification-triggers">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Notification Trigger Logic</div>
                                <div class="test-description">Test notification system triggers and conditions</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query">mutation TestNotificationTrigger($input: CreateSignalEventsInput!) {
  createSignalEvents(input: $input) {
    id
    signalType
    processed
    triggeredNotifications {
      items {
        id
        eventType
        status
      }
    }
  }
}

# Variables:
{
  "input": {
    "signalType": "form_contact_us_submission",
    "payload": {
      "customerName": "Test Customer",
      "customerEmail": "test@example.com",
      "estimatedValue": 15000
    },
    "source": "test_suite"
  }
}</div>
                        <div class="test-result" id="result-business-notification-triggers">Waiting to run...</div>
                    </div>
                </div>
                
                <div class="test-case" data-test="business-status-transitions">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Status Transition Rules</div>
                                <div class="test-description">Test valid and invalid status transitions</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query"># Test invalid status transition
mutation TestStatusTransition($input: UpdateProjectsInput!) {
  updateProjects(input: $input) {
    id
    status
    statusOrder
  }
}

# Variables:
{
  "input": {
    "id": "test-project-id",
    "status": "completed"
    # Invalid transition from draft to completed
  }
}</div>
                        <div class="test-result" id="result-business-status-transitions">Waiting to run...</div>
                    </div>
                </div>
                
                <div class="test-case" data-test="business-data-relationships">
                    <div class="test-header" onclick="toggleTestCase(this)">
                        <div class="test-info">
                            <span class="status-badge status-pending">‚è≥</span>
                            <div>
                                <div class="test-name">Data Relationship Integrity</div>
                                <div class="test-description">Test referential integrity and relationship constraints</div>
                            </div>
                        </div>
                        <div class="test-meta">
                            <span class="test-duration">-</span>
                        </div>
                    </div>
                    <div class="test-body">
                        <div class="test-query"># Test creating project with invalid contact references
mutation TestInvalidReferences($input: CreateProjectsInput!) {
  createProjects(input: $input) {
    id
    title
    homeownerContactId
    agentContactId
  }
}

# Variables:
{
  "input": {
    "title": "Test Project",
    "homeownerContactId": "nonexistent-contact-id",
    "agentContactId": "invalid-agent-id"
  }
}</div>
                        <div class="test-result" id="result-business-data-relationships">Waiting to run...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test configuration and state
        let amplifyConfig = null;
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            durations: []
        };
        
        // Test definitions
        const testSuites = {
            authentication: [
                'auth-no-token',
                'auth-api-key',
                'auth-jwt-token',
                'auth-role-permissions'
            ],
            validation: [
                'validation-required-fields',
                'validation-email-format',
                'validation-enum-values',
                'validation-data-types'
            ],
            business: [
                'business-assignment-rules',
                'business-notification-triggers',
                'business-status-transitions',
                'business-data-relationships'
            ]
        };
        
        // Initialize test runner
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const configResponse = await fetch('../amplify_outputs.json');
                amplifyConfig = await configResponse.json();
                logMessage('info', 'Loaded Amplify configuration successfully');
                
                // Auto-populate API key if available
                if (amplifyConfig?.data?.api_key) {
                    document.getElementById('apiKey').value = amplifyConfig.data.api_key;
                    logMessage('success', 'API key loaded from configuration');
                }
            } catch (error) {
                logMessage('error', `Failed to load configuration: ${error.message}`);
            }
        });
        
        // GraphQL request function
        async function executeGraphQL(query, variables = {}, useAuth = true) {
            if (!amplifyConfig?.data?.url) {
                throw new Error('GraphQL endpoint not configured');
            }
            
            const headers = {
                'Content-Type': 'application/json',
            };
            
            if (useAuth) {
                const apiKey = document.getElementById('apiKey').value;
                const authToken = document.getElementById('authToken').value;
                
                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                } else if (apiKey) {
                    headers['x-api-key'] = apiKey;
                }
            }
            
            const startTime = performance.now();
            
            const response = await fetch(amplifyConfig.data.url, {
                method: 'POST',
                headers,
                body: JSON.stringify({ query, variables })
            });
            
            const duration = performance.now() - startTime;
            const result = await response.json();
            
            return { result, duration, status: response.status };
        }
        
        // Run individual test
        async function runTest(testId) {
            const testElement = document.querySelector(`[data-test="${testId}"]`);
            const statusBadge = testElement.querySelector('.status-badge');
            const durationElement = testElement.querySelector('.test-duration');
            const resultElement = document.getElementById(`result-${testId}`);
            
            // Update status to running
            statusBadge.className = 'status-badge status-running';
            statusBadge.textContent = 'üèÉ‚Äç‚ôÇÔ∏è';
            resultElement.className = 'test-result info';
            resultElement.textContent = 'Running test...';
            
            try {
                const testConfig = getTestConfig(testId);
                const { result, duration, status } = await executeGraphQL(
                    testConfig.query,
                    testConfig.variables,
                    testConfig.useAuth
                );
                
                testResults.durations.push(duration);
                durationElement.textContent = `${Math.round(duration)}ms`;
                
                // Evaluate test result
                const success = evaluateTestResult(testId, result, status);
                
                if (success) {
                    statusBadge.className = 'status-badge status-passed';
                    statusBadge.textContent = '‚úÖ';
                    resultElement.className = 'test-result success';
                    testResults.passed++;
                    logMessage('success', `${testId}: PASSED (${Math.round(duration)}ms)`);
                } else {
                    statusBadge.className = 'status-badge status-failed';
                    statusBadge.textContent = '‚ùå';
                    resultElement.className = 'test-result error';
                    testResults.failed++;
                    logMessage('error', `${testId}: FAILED (${Math.round(duration)}ms)`);
                }
                
                // Display result
                resultElement.textContent = formatTestResult(testId, result, success);
                
            } catch (error) {
                statusBadge.className = 'status-badge status-failed';
                statusBadge.textContent = '‚ùå';
                resultElement.className = 'test-result error';
                resultElement.textContent = `Error: ${error.message}`;
                testResults.failed++;
                logMessage('error', `${testId}: ERROR - ${error.message}`);
            }
            
            testResults.total++;
            updateStats();
        }
        
        // Get test configuration
        function getTestConfig(testId) {
            const configs = {
                'auth-no-token': {
                    query: `mutation TestUnauthenticated {
                        createContacts(input: {
                            fullName: "Test User"
                            email: "test@example.com"
                        }) {
                            id
                            fullName
                            email
                        }
                    }`,
                    variables: {},
                    useAuth: false
                },
                'auth-api-key': {
                    query: `query TestApiKeyAccess {
                        listContacts(limit: 5) {
                            items {
                                id
                                fullName
                                email
                            }
                        }
                    }`,
                    variables: {},
                    useAuth: true
                },
                'auth-jwt-token': {
                    query: `query TestJwtAccess {
                        listRequests(limit: 5) {
                            items {
                                id
                                status
                                priority
                                homeowner {
                                    fullName
                                    email
                                }
                            }
                        }
                    }`,
                    variables: {},
                    useAuth: true
                },
                'validation-required-fields': {
                    query: `mutation TestRequiredFields {
                        createContacts(input: {
                            fullName: "Test User"
                        }) {
                            id
                            fullName
                            email
                        }
                    }`,
                    variables: {},
                    useAuth: true
                },
                'validation-email-format': {
                    query: `mutation TestEmailFormat {
                        createContacts(input: {
                            fullName: "Test User"
                            email: "invalid-email-format"
                        }) {
                            id
                            fullName
                            email
                        }
                    }`,
                    variables: {},
                    useAuth: true
                }
                // Add more test configurations as needed
            };
            
            return configs[testId] || {
                query: 'query TestQuery { __typename }',
                variables: {},
                useAuth: true
            };
        }
        
        // Evaluate test result
        function evaluateTestResult(testId, result, status) {
            switch (testId) {
                case 'auth-no-token':
                    // Should fail with authentication error
                    return result.errors && result.errors.some(e => 
                        e.message.includes('Unauthorized') || 
                        e.extensions?.code === 'UNAUTHORIZED'
                    );
                    
                case 'auth-api-key':
                    // Should succeed with API key
                    return !result.errors && result.data?.listContacts;
                    
                case 'auth-jwt-token':
                    // Should succeed with valid JWT or fail appropriately
                    const authToken = document.getElementById('authToken').value;
                    if (!authToken) {
                        return result.errors && result.errors.some(e => 
                            e.message.includes('Unauthorized')
                        );
                    }
                    return !result.errors && result.data?.listRequests;
                    
                case 'validation-required-fields':
                case 'validation-email-format':
                    // Should fail with validation error
                    return result.errors && result.errors.some(e => 
                        e.message.includes('validation') || 
                        e.extensions?.code === 'VALIDATION_ERROR'
                    );
                    
                default:
                    // Generic success check
                    return !result.errors;
            }
        }
        
        // Format test result for display
        function formatTestResult(testId, result, success) {
            if (result.errors) {
                const errorMessages = result.errors.map(e => 
                    `${e.message}${e.extensions?.code ? ` (${e.extensions.code})` : ''}`
                ).join('\n');
                
                return success ? 
                    `‚úÖ Expected Error:\n${errorMessages}` : 
                    `‚ùå Unexpected Error:\n${errorMessages}`;
            }
            
            if (result.data) {
                return success ? 
                    `‚úÖ Success:\n${JSON.stringify(result.data, null, 2)}` : 
                    `‚ùå Unexpected Success:\n${JSON.stringify(result.data, null, 2)}`;
            }
            
            return 'No data returned';
        }
        
        // Run all tests
        async function runAllTests() {
            resetTestResults();
            logMessage('info', 'Starting comprehensive test suite...');
            
            const allTests = [
                ...testSuites.authentication,
                ...testSuites.validation,
                ...testSuites.business
            ];
            
            for (let i = 0; i < allTests.length; i++) {
                const testId = allTests[i];
                await runTest(testId);
                
                // Update progress
                const progress = ((i + 1) / allTests.length) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
                
                // Small delay to see progress
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            logMessage('success', `Test suite completed: ${testResults.passed} passed, ${testResults.failed} failed`);
        }
        
        // Run specific test suite
        async function runSuite(suiteName) {
            const tests = testSuites[suiteName];
            if (!tests) return;
            
            logMessage('info', `Running ${suiteName} test suite...`);
            
            for (const testId of tests) {
                await runTest(testId);
            }
            
            const suiteStatus = document.getElementById(`${suiteName}Status`);
            const suitePassed = tests.every(testId => {
                const element = document.querySelector(`[data-test="${testId}"] .status-badge`);
                return element.classList.contains('status-passed');
            });
            
            if (suitePassed) {
                suiteStatus.className = 'status-badge status-passed';
                suiteStatus.textContent = 'Passed';
            } else {
                suiteStatus.className = 'status-badge status-failed';
                suiteStatus.textContent = 'Failed';
            }
            
            logMessage('success', `${suiteName} suite completed`);
        }
        
        // UI Helper functions
        function toggleTestCase(header) {
            const testBody = header.nextElementSibling;
            testBody.classList.toggle('active');
        }
        
        function resetTestResults() {
            testResults = { total: 0, passed: 0, failed: 0, durations: [] };
            
            // Reset all test statuses
            document.querySelectorAll('.test-case .status-badge').forEach(badge => {
                badge.className = 'status-badge status-pending';
                badge.textContent = '‚è≥';
            });
            
            // Reset suite statuses
            document.querySelectorAll('[id$="Status"]').forEach(status => {
                status.className = 'status-badge status-pending';
                status.textContent = 'Pending';
            });
            
            // Reset results
            document.querySelectorAll('[id^="result-"]').forEach(result => {
                result.className = 'test-result';
                result.textContent = 'Waiting to run...';
            });
            
            // Reset durations
            document.querySelectorAll('.test-duration').forEach(duration => {
                duration.textContent = '-';
            });
            
            // Reset progress
            document.getElementById('progressFill').style.width = '0%';
            
            updateStats();
        }
        
        function clearResults() {
            resetTestResults();
            document.getElementById('logViewer').innerHTML = `
                <div class="log-entry">
                    <span class="log-timestamp">00:00:00</span>
                    <span class="log-level-info">[INFO]</span>
                    <span>Test results cleared. Ready for new test run.</span>
                </div>
            `;
            logMessage('info', 'Test results cleared');
        }
        
        function updateStats() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            
            const avgDuration = testResults.durations.length > 0 ? 
                Math.round(testResults.durations.reduce((a, b) => a + b, 0) / testResults.durations.length) : 0;
            document.getElementById('avgDuration').textContent = `${avgDuration}ms`;
        }
        
        function logMessage(level, message) {
            const logViewer = document.getElementById('logViewer');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">${timestamp}</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                <span>${message}</span>
            `;
            
            logViewer.appendChild(logEntry);
            logViewer.scrollTop = logViewer.scrollHeight;
        }
    </script>
</body>
</html>